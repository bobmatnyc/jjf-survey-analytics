{% extends "base.html" %}

{% block title %}Error - Surveyor Data Viewer{% endblock %}

{% block header %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-red-600 mb-2">
        <i class="fas fa-exclamation-triangle mr-3"></i>
        Error
    </h1>
    <p class="text-gray-600">Something went wrong while processing your request</p>
</div>
{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-8 text-center">
    <!-- Error Icon -->
    <div class="w-20 h-20 mx-auto mb-6 bg-red-100 rounded-full flex items-center justify-center">
        <i class="fas fa-exclamation-triangle text-red-500 text-3xl"></i>
    </div>
    
    <!-- Error Message -->
    <h2 class="text-2xl font-bold text-gray-900 mb-4">Oops! Something went wrong</h2>
    
    {% if error %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 max-w-2xl mx-auto">
        <div class="flex items-start">
            <i class="fas fa-bug text-red-500 mt-1 mr-3"></i>
            <div class="text-left">
                <h3 class="text-sm font-medium text-red-800 mb-2">Error Details</h3>
                <p class="text-sm text-red-700 font-mono break-words">{{ error }}</p>
            </div>
        </div>
    </div>
    {% else %}
    <p class="text-gray-600 mb-6">An unexpected error occurred while processing your request.</p>
    {% endif %}
    
    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
        <a href="{{ url_for('dashboard') }}" 
           class="inline-flex items-center px-6 py-3 bg-survey-blue text-white rounded-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-home mr-2"></i>
            Go to Dashboard
        </a>
        
        <button onclick="history.back()" 
                class="inline-flex items-center px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            Go Back
        </button>
        
        <button onclick="location.reload()" 
                class="inline-flex items-center px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
            <i class="fas fa-redo mr-2"></i>
            Try Again
        </button>
    </div>
    
    <!-- Help Section -->
    <div class="mt-8 pt-6 border-t border-gray-200">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Need Help?</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto">
            <!-- Check Database -->
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-database text-blue-600"></i>
                </div>
                <h4 class="font-medium text-gray-900 mb-2">Check Database</h4>
                <p class="text-sm text-gray-600">Ensure the database file exists and is accessible</p>
            </div>
            
            <!-- Run Extractor -->
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-download text-green-600"></i>
                </div>
                <h4 class="font-medium text-gray-900 mb-2">Run Extractor</h4>
                <p class="text-sm text-gray-600">Try running the data extractor to refresh data</p>
            </div>
            
            <!-- Check Logs -->
            <div class="bg-gray-50 rounded-lg p-4">
                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-file-alt text-purple-600"></i>
                </div>
                <h4 class="font-medium text-gray-900 mb-2">Check Logs</h4>
                <p class="text-sm text-gray-600">Review the console output for detailed error information</p>
            </div>
        </div>
    </div>
    
    <!-- Technical Details -->
    <div class="mt-6 text-left max-w-2xl mx-auto">
        <details class="bg-gray-50 rounded-lg p-4">
            <summary class="cursor-pointer text-sm font-medium text-gray-700 hover:text-gray-900">
                <i class="fas fa-cog mr-2"></i>
                Technical Details
            </summary>
            <div class="mt-3 pt-3 border-t border-gray-200">
                <dl class="grid grid-cols-1 gap-2 text-sm">
                    <div class="flex justify-between">
                        <dt class="font-medium text-gray-600">Timestamp:</dt>
                        <dd class="text-gray-900 font-mono">{{ now.strftime('%Y-%m-%d %H:%M:%S') }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="font-medium text-gray-600">Request URL:</dt>
                        <dd class="text-gray-900 font-mono break-all">{{ request.url }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="font-medium text-gray-600">Method:</dt>
                        <dd class="text-gray-900 font-mono">{{ request.method }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="font-medium text-gray-600">User Agent:</dt>
                        <dd class="text-gray-900 font-mono text-xs break-all">{{ request.headers.get('User-Agent', 'Unknown') }}</dd>
                    </div>
                </dl>
            </div>
        </details>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Auto-report error (optional)
    document.addEventListener('DOMContentLoaded', function() {
        // You could implement automatic error reporting here
        console.error('Error page loaded:', {
            url: window.location.href,
            timestamp: new Date().toISOString(),
            error: '{{ error|e }}'
        });
    });
</script>
{% endblock %}
